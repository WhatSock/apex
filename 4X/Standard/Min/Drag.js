/*@license
ARIA Drag and Drop Module 1.1 for Apex 4X
Author: Bryan Garaventa (https://www.linkedin.com/in/bgaraventa)
Home: WhatSock.com  :  Download: https://github.com/whatsock/apex
License: MIT (https://opensource.org/licenses/MIT)

Required dependencies: Animate.js, Menu.js, Dragula.css, Dragula.js
*/
"setDrag"in $A||$A.extend({setDrag:function(l){function a(e,d,o){var n,t,c;$A.isArray(e)?$A.loop(e,function(n,t){a(t,d,o)},"array"):((c=$A.data(e,"actions"))&&($A.remove(c.button),$A.remove(c.menu),$A.destroy(c.DC)),$A.isArray(o)&&o.length&&(c={button:$A.morph(l.menu.tag.button),menu:$A.morph(l.menu.tag.menu),children:[],dragElement:e,sourceContainer:d},p&&(n="horizontal"===(n=$A.getOrientation(d.children)).orientation&&!n.lineWrap,$A.previous(e)&&(t=$A.morph(l.menu.tag[n?"left":"up"]),c.children.push(t),c.menu.appendChild(t)),$A.next(e))&&(t=$A.morph(l.menu.tag[n?"right":"down"]),c.children.push(t),c.menu.appendChild(t)),$A.loop(o,function(n,t){var o=($A.getAttr(t,"data-dropname")||"").replace(/<|>/g,"");if(!o)throw"The drop-zone container element is missing a unique and informative data-dropname attribute.";o=$A.morph(l.menu.tag[m?"copy":"move"].replace("%DROPNAME%",o));l.dragula.accepts(e,t,d)&&t!==d&&($A.data(o,"DropContainer",t),c.children.push(o),c.menu.appendChild(o))},"array"),$A.loop(l.menu.tag.custom,function(n,t){t=$A.morph(t);l.menu.tag.invalid(e,$A.getAttr(t.firstChild,"data-action"),d)||(c.children.push(t),c.menu.appendChild(t))},"array"),$A[l.menu.tag.render](c.button,e),$A.after(c.menu,c.button),$A(c.button).describedBy(e),$A.setKBA11Y(c.button,"button"),$A(c.button).on("click mousedown mouseup mousemove touchstart touchend touchmove",function(n){n.stopPropagation()}),c.DC=$A.setMenu(c.button,$A.extend(!0,{toggleHide:!0,onActivate:function(a,r,n,t,o,e,i){var u=$A.data(r.parentNode,"DropContainer");n.DC.top.remove(function(){var n=$A.previous(c.dragElement),t=$A.next(c.dragElement),o=t||d,e=$A.getAttr(r,"data-action");s.emit("beforeClone",c.dragElement),!p||"up"!==e&&"down"!==e?u?s.emit("drop",c.dragElement,u,d,t,function(){l.menu.manualDrop(c.dragElement,u,d,e,c,o)||$A[l.render](m?c.dragElement.cloneNode(!0):c.dragElement,u),s.emit("dragend",c.dragElement),$A.data(t,"actions")&&(o=$A.data(t,"actions").button),$A.focus(o)}):$A.isFn(l.menu.tag.customActivate)&&(l.menu.manualDrop(c.dragElement,u,d,e,c,t)||l.menu.tag.customActivate(a,c.dragElement,d,e,c,o),s.emit("dragend",c.dragElement),$A.data(t,"actions")&&(o=$A.data(t,"actions").button),$A.focus(o)):s.emit("drop",c.dragElement,u,d,t,function(){l.menu.manualDrop(c.dragElement,u,d,e,c,o)||("up"===e?($A.before(c.dragElement,n),s.emit("dragend",c.dragElement),$A.data(c.dragElement,"actions")&&(o=$A.data(c.dragElement,"actions").button),$A.focus(o)):"down"===e&&($A.after(c.dragElement,t),s.emit("dragend",c.dragElement),$A.data(c.dragElement,"actions")&&(o=$A.data(c.dragElement,"actions").button),$A.focus(o)))})})},animate:{onRender:function(n,t,o){window.Velocity(t,"transition.slideUpIn",{complete:function(){o()}})},onRemove:function(n,t,o){window.Velocity(t,"transition.slideUpOut",{complete:function(){o()}})}},click:function(n,t){n.stopPropagation()},mouseDown:function(n,t){n.stopPropagation()},mouseUp:function(n,t){n.stopPropagation()},mouseMove:function(n,t){n.stopPropagation()},touchStart:function(n,t){n.stopPropagation()},touchEnd:function(n,t){n.stopPropagation()},touchMove:function(n,t){n.stopPropagation()}},l.menu)),$A.data(e,"actions",c)))}var m=(l=$A.extend(!0,{render:"append",sort:!1,dragula:{revertOnSpill:!0,invalid:function(n,t){return!1},accepts:function(n,t,o,e){return!!p||o!==t}},menu:{manualDrop:function(n,t,o,e,a,r){return!1},tag:{render:"append",button:'<a aria-label="Actions" class="aria-action-menu-button">&darr;</a>',menu:'<ul hidden class="drag top menu"></ul>',move:'<li><a data-action="move" class="menu-action move">Move to %DROPNAME%</a></li>',copy:'<li><a data-action="copy" class="menu-action copy">Copy to %DROPNAME%</a></li>',up:'<li><a data-action="up" class="menu-action up">Move Up</a></li>',left:'<li><a data-action="up" class="menu-action left">Move Left</a></li>',down:'<li><a data-action="down" class="menu-action down">Move Down</a></li>',right:'<li><a data-action="down" class="menu-action right">Move Right</a></li>',custom:[],customActivate:null,invalid:function(n,t,o,e){return!1}}}},l)).dragula.copy||!1,p=l.sort||l.dragula.copySortSource||!1,s=window.dragula(l.dragula).on("beforeClone",function(n){a(n)}).on("drop",function(n,t,o,e,a){$A.isFn(a)&&a()}).on("dragend",function(n){t()}),t=function(){$A.loop(s.containers,function(n,t){a(t.children,t,s.containers)},"array")};return t(),s},unsetDrag:function(n){$A.loop(n.containers,function(n,t){$A.loop(t.children,function(n,t){t=$A.data(t,"actions");t&&($A.remove(t.button),$A.remove(t.menu),$A.destroy(t.DC))},"array")},"array"),n.destroy()}});