/*@license
ARIA Menu Module 3.0 for Apex 4X
Author: Bryan Garaventa (https://www.linkedin.com/in/bgaraventa)
Home: WhatSock.com  :  Download: https://github.com/whatsock/apex
License: MIT (https://opensource.org/licenses/MIT)

Required dependencies: RovingTabIndex.js
  */
"setMenu"in $A||$A.import("RovingTabIndex",{name:"MenuModule",props:props,once:!0,call:function(e){$A.addWidgetProfile("Menu",{configure:function(e){return{horizontalHelpTip:"To move through items, press left or right arrow.",verticalHelpTip:"To move through items, press up or down arrow.",toggleHide:!0,forceFocus:!0,forceFocusWithin:!0,returnFocus:!0,preload:!0,preloadImages:!0,preloadCSS:!0,className:"menu",escToClose:!0,click:function(e,t){e.stopPropagation()},storeData:!0}},role:function(e){return{role:"menu","aria-orientation":$A.getOrientation(e.RTI.nodes).orientation}},afterRender:function(e){$A.isTouch||setTimeout(function(){$A.announce(e["horizontal"===e.getAttr("aria-orientation")?"horizontalHelpTip":"verticalHelpTip"])},1)},beforeRemove:function(e){$A.loop(e.RTI.children,function(e,t){t.DC.remove()},"map")}});var t=$A.isIE();$A.extend({setMenu:function(e,u){if(this._4X&&(u=e,e=this._X),$A.isPlainObject(e)&&(e=(u=e).trigger||null),!e)return null;function l(n,e,t,r,o){if(t){var i="menuitemradio"===$A.getAttr(n,"role"),a=0;return"true"===e?a=1:i||"mixed"!==e?e="false":a=2,$A.data(n,"check",a),r&&(i&&$A.isArray(o)&&$A.loop(o,function(e,t){$A.hasAttr(t,"aria-checked")&&t!==n&&$A.setAttr(t,"aria-checked","false")},"array"),$A.setAttr(n,"aria-checked",e)),a}var u=$A.data(n,"check");return!!$A.isNum(u)&&u}u=u||{};var c=null,o=$A.extend(!0,{parent:"ul",child:"a",parse:function(e){if(t){var r=[];return $A.query(e.children,function(e,t){var n=$A.first(t,function(e){if(e.nodeName.toLowerCase()===o.child)return!0});$A.isNode(n)&&r.push(n)}),r}return e.querySelectorAll(":scope > * > "+o.child)}},u.tag||{}),s=function(e,t,n){if($A.isNode(e)){var i=n||$A.getAttr(e,"data-menu")||$A.next(e,function(e){if(e.nodeName.toLowerCase()===o.parent)return!0});if(i=$A.morph(i),$A.isNode(i)){$A.setAttr(e,"aria-haspopup","true");var r=o.parse(i);$A.svgFix(i);var a=$A.toDC($A.extend({trigger:e,content:i,on:"openmenu",widgetType:"Menu",toggleHide:!0,getState:l},u));return t&&a.map({parent:t.DC}),a.RTI=new $A.RovingTabIndex($A.extend({DC:a,parent:t,trigger:e,nodes:r,startIndex:0,orientation:2,autoSwitch:u.autoSwitch||"semi",autoLoop:!0,onOpen:function(e,o,i,t,n){var r=$A.isDisabled(this),a=l(o);if(!r||n)if($A.isDC(t))t.render(),e.preventDefault();else{if(n)return;$A.isFn(u.onActivate)&&u.onActivate.apply(this,[e,o,i,t||$A.boundTo(o),a,function(e){var t=$A.getAttr(o,"role"),n=-1!==["menuitemradio"].indexOf(t),r=-1!==["menuitemcheckbox"].indexOf(t);(n||r)&&l(o,e,!0,!0,n?i.nodes:null)},"menuitemradio"===$A.getAttr(o,"role")])}else $A.isDC(i.DC)&&i.DC.top.remove()},onSpace:function(e,t,n,r){$A.isDC(r)&&r.render(),e.preventDefault()},onEnter:function(e,t,n,r){$A.isDC(r)&&r.render(),e.preventDefault()},onClose:function(e,t,n,r,o){$A.isDC(n.DC)&&n.parent&&n.DC.remove(function(){setTimeout(function(){$A.announce(n.parent.DC["horizontal"===n.parent.DC.getAttr("aria-orientation")?"horizontalHelpTip":"verticalHelpTip"])},1)}),e.preventDefault()},onEsc:function(e,t,n,r){$A.isDC(n.DC)&&n.DC.remove(),e.preventDefault()},onShiftTab:function(e,t,n,r){$A.isDC(n.DC)&&n.DC.top.remove(),e.preventDefault()},onTab:function(e,t,n,r){$A.isDC(n.DC)&&n.DC.top.remove(),e.preventDefault()}},u.extendRTI||{})),$A.loop(r,function(e,t){s(t,a.RTI);var n=l(t,$A.getAttr(t,"data-radio"),$A.hasAttr(t,"data-radio")),r=l(t,$A.getAttr(t,"data-check"),$A.hasAttr(t,"data-check")),c=$A.isFn(t.querySelector)&&t.querySelector("input")||!1;if($A.isNum(n))c&&c.checked&&(n=1),$A.setAttr(t,{role:"menuitemradio","aria-checked":n?"true":"false"});else if($A.isNum(r)){c&&c.checked&&(r=1);var o="false";1===r?o="true":2===r&&(o="mixed"),$A.setAttr(t,{role:"menuitemcheckbox","aria-checked":o})}else $A.setAttr(t,"role","menuitem");!1===n&&!1===r||$A(t).on("attributeChange",function(e,t,n,r,o,i,a){if($A.isNode(c)){var u=l(t,r,!0);c.checked=!!u}},{attributeFilter:["aria-checked"]}),$A.closest(t,function(e){if(e===i)return!0;$A.setAttr(e,"role","presentation")})},"array"),$A.updateDisabled(r),a}}},A=null;return $A.query(e,u.context||document,function(e,n){function t(e){var t;A=s(n,null,e),$A.on(window.document,"click.closemenus",function(){A.top.remove()}),u.rightClick||(u.leftClick=!0),u.leftClick&&(t={keydown:function(e,t){var n=$A.keyEvent(e);40!==n&&13!==n&&32!==n||(t.render(),e.stopPropagation(),e.preventDefault())},click:function(e,t){t.render(),e.stopPropagation(),e.preventDefault()}}),u.rightClick&&(t={contextmenu:function(e,t){e.preventDefault()},mouseup:function(e,t){2==($A.isNum(e.which)?e.which<2?1:2===e.which?3:2:e.button<2?1:4===e.button?3:2)&&(t.render(),e.preventDefault())},keydown:function(e,t){var n=$A.keyEvent(e);(93===n||e.shiftKey&&121===n)&&(t.render(),e.preventDefault())}}),$A.on(n,t)}var r=u.fetch&&u.fetch.url||$A.getAttr(n,"data-menu"),o=u.fetch&&u.fetch.data&&u.fetch.data.selector||$A.getSelectorFromURI(r),i=!(!o||!$A.isPath(r));if(u.fetch=null,i){u.toggleHide=!1;var a=$A.toNode();$A.load(r,a,{selector:o},function(e){t(c=e)})}else t(c)}),$A._XR.call(this,A)}})}});