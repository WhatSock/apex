/*!
Roving TabIndex Module 1.0 for Apex 4X
Copyright 2021 Bryan Garaventa (WhatSock.com)
https://github.com/whatsock/apex
Apex 4X is distributed under the terms of the Open Source Initiative OSI - MIT License.
*/
"RovingTabIndex"in $A||$A.import("AccName",{name:"RovingTabIndexModule",props:props,once:!0,call:function(t){$A.extend({RovingTabIndex:function(t){var $=this;for($.typed="",$.lastTyped="",$.nodes=t.nodes,$.container=t.container||!1,$.orientation=t.orientation&&0<=t.orientation&&t.orientation<=2?t.orientation:0,$.autoSwitch=t.autoSwitch||"off",$.index=t.startIndex&&0<=t.startIndex?t.startIndex:0,$.parent=!!(t.parent&&t.parent.nodes&&t.parent.nodes.length)&&t.parent,$.top=$;$.top.parent;)$.top=$.top.parent;if($.children=new Map,$.trigger=!(!t.trigger||1!==t.trigger.nodeType)&&t.trigger,$.autoLoop=t.autoLoop||!1,$A.loop(t,function(t,e){"on"===t.slice(0,2)&&$A.isFn(e)&&($[t]=e)},"object"),$.isTree=!0===t.isTree,$.parent&&$.trigger&&$.parent.children.set($.trigger,$),$.dc=$.DC=t.dc||t.DC||null,t.breakPoint&&(1<t.breakPoint.horizontal||1<t.breakPoint.vertical)?$.breakPoint={horizontal:1<t.breakPoint.horizontal?t.breakPoint.horizontal:0,vertical:1<t.breakPoint.vertical?t.breakPoint.vertical:0,horizontalStop:!!t.breakPoint.horizontalStop,verticalStop:!!t.breakPoint.verticalStop}:$.breakPoint=!1,$.activate=function(n){var t=$;return $A.isNum(n)&&(n=$.nodes[n]||null,t=$A.data(n,"RTI")||$),n=n||t.nodes[0]||null,$A.isNode(n)&&$A.isNum($A.data(n,"RTI-Index"))&&(t=$A.data(n,"RTI"),$A.isHidden(n)||(t.index=$A.data(n,"RTI-Index"),$A.loop(t.nodes,function(t,e){$A.setAttr(e,{tabindex:n===e?0:-1})},"array"))),t},$.setFocus=function(t,e,n){return(e=e||$).activate(this),n||this.focus(),e},$.focus=function(t){var e=$;return $A.isNum(t)&&(t=$.nodes[t]||null,e=$A.data(t,"RTI")||$),t=t||e.nodes[0]||null,$A.isNode(t)&&$A.isNum($A.data(t,"RTI-Index"))&&(e=$A.data(t,"RTI"),$A.isHidden(t)||(e.activate(t),t.focus())),e},$.off=function(){return $A.off($.nodes,".RovingTabIndex"),$},$.on=function(){var A=[],t=0,e=0,C=0,y=new Map;$.off(),$A.loop($.nodes,function(o,f){function u(t){x.alt=t.altKey,x.ctrl=t.ctrlKey,x.shift=t.shiftKey}function g(t,i,o,a,r){a=a||$A.boundTo(o);var l=!1;return $A.loop(t,function(t,e){if($A.isFn($["on"+e]))var n=!1===$["on"+e].call(o,i,o,$,a,r,0===$.index,$.index===$.nodes.length-1);n&&(l=!0)},"array"),l}$A.data(f,"RTI",$),$A.data(f,"RTI-Index",o),$A.data(f,"AccName",$A.trim($A.isFn(window.getAccName)&&window.getAccName(f).name||$A.getText(f)).toLowerCase()),$.breakPoint&&(A[e]||(A[e]=[]),A[e].push(f),y.set(f,{i:o,x:t,y:e}),C=e,$.breakPoint.horizontal===t?(t=0,e++):t++);var x={};$A.on(f,{click:function(t,e){var n=$.children.get(f),i=n&&n.DC||e;if($.index=o,$.setFocus.apply($.nodes[$.index],[t,$]),$.DC&&($.DC.loading||$.DC.closing)||i&&(i.loading||i.closing))return t.preventDefault(),t.stopPropagation(),!1;g(["Click","Open"],t,f,i,0)},touchstart:function(t,e){var n=$.children.get(f),i=n&&n.DC||e;if($.index=o,$.setFocus.apply($.nodes[$.index],[t,$]),$.DC&&($.DC.loading||$.DC.closing)||i&&(i.loading||i.closing))return t.preventDefault(),t.stopPropagation(),!1;g(["TouchStart"],t,f,i,0)},keydown:function(t,e){if(u(t),"semi"===$.autoSwitch||"full"===$.autoSwitch){var n=$A.getOrientation($.nodes);"vertical"===n.orientation?$.orientation=2:"horizontal"===n.orientation&&($.orientation="full"===$.autoSwitch&&n.lineWrap?0:1)}var s=$A.keyEvent(t),i=0,o=y.get(f),a=$.children.get(f),r=a&&a.DC||e,l=[],h=!1,p=!1;if($.DC&&($.DC.loading||$.DC.closing)||r&&(r.loading||r.closing))return t.preventDefault(),t.stopPropagation(),!1;if(35<=s&&s<=40){i=37<=s&&s<=40?s:0;var c=$.index,d=!1;i&&($.arrowPressed=!0,l.push("Arrow")),37===s?x.alt||x.ctrl||x.shift?x.alt||!x.ctrl||x.shift?x.alt||x.ctrl||!x.shift?!x.alt&&x.ctrl&&x.shift&&l.push("CtrlShiftLeft"):l.push("ShiftLeft"):l.push("CtrlLeft"):l.push("Left"):38===s?x.alt||x.ctrl||x.shift?x.alt||!x.ctrl||x.shift?x.alt||x.ctrl||!x.shift?!x.alt&&x.ctrl&&x.shift&&l.push("CtrlShiftUp"):l.push("ShiftUp"):l.push("CtrlUp"):l.push("Up"):39===s?x.alt||x.ctrl||x.shift?x.alt||!x.ctrl||x.shift?x.alt||x.ctrl||!x.shift?!x.alt&&x.ctrl&&x.shift&&l.push("CtrlShiftRight"):l.push("ShiftRight"):l.push("CtrlRight"):l.push("Right"):40===s&&(x.alt||x.ctrl||x.shift?x.alt||!x.ctrl||x.shift?x.alt||x.ctrl||!x.shift?!x.alt&&x.ctrl&&x.shift&&l.push("CtrlShiftDown"):l.push("ShiftDown"):l.push("CtrlDown"):l.push("Down")),h=g(l,t,f,r,i),l=[],h&&(p=!0),x.alt||x.ctrl||x.shift||!(39===s&&2===$.orientation||40===s&&1===$.orientation)?x.alt||x.ctrl||x.shift||!(37===s&&2===$.orientation||38===s&&1===$.orientation)?37===s&&(0===$.orientation||1===$.orientation)||38===s&&(0===$.orientation||2===$.orientation)?(0===$.index&&(h=g(["Top"],t,f,r,i)),h&&(p=!0),$.breakPoint?!$.breakPoint.horizontal||37!==s||0!==$.orientation&&1!==$.orientation?!$.breakPoint.vertical||38!==s||0!==$.orientation&&2!==$.orientation||(0<o.y?$.index=y[A[o.y-1][o.x]].i:0===o.y&&$A.isFn($.onBounds)&&$.onBounds.apply(f,[t,f,$,s])):0<o.x||0===o.x&&0<o.y&&!$.breakPoint.horizontalStop?$.index--:0===o.x&&0===o.y&&$A.isFn($.onBounds)&&$.onBounds.apply(f,[t,f,$,s]):p||($.index=0===$.index?$.autoLoop?$.nodes.length-1:c:$.index-1)):39===s&&(0===$.orientation||1===$.orientation)||40===s&&(0===$.orientation||2===$.orientation)?($.index===$.nodes.length-1&&(h=g(["Bottom"],t,f,r,i)),h&&(p=!0),$.breakPoint?!$.breakPoint.horizontal||39!==s||0!==$.orientation&&1!==$.orientation?!$.breakPoint.vertical||40!==s||0!==$.orientation&&2!==$.orientation||(o.y<C?$.index=y[A[o.y+1][o.x]].i:o.y===C&&$A.isFn($.onBounds)&&$.onBounds.apply(f,[t,f,$,s])):o.x<$.breakPoint.horizontal||o.x===$.breakPoint.horizontal&&o.y<C&&!$.breakPoint.horizontalStop?$.index++:o.x===$.breakPoint.horizontal&&o.y===C&&$A.isFn($.onBounds)&&$.onBounds.apply(f,[t,f,$,s]):p||($.index=$.index===$.nodes.length-1?$.autoLoop?0:c:$.index+1)):35===s?(x.alt||x.ctrl||x.shift?x.alt||!x.ctrl||x.shift?x.alt||x.ctrl||!x.shift?!x.alt&&x.ctrl&&x.shift&&l.push("CtrlShiftEnd"):l.push("ShiftEnd"):(l.push("CtrlEnd"),d=!0):l.push("End"),h=g(l,t,f,r,i),l=[],h&&(p=!0),!p&&$.breakPoint&&0<$.breakPoint.horizontal&&o.x<$.breakPoint.horizontal?$.index=y[A[o.y][$.breakPoint.horizontal]].i:p||($.index=$.nodes.length-1)):36===s&&(x.alt||x.ctrl||x.shift?x.alt||!x.ctrl||x.shift?x.alt||x.ctrl||!x.shift?!x.alt&&x.ctrl&&x.shift&&l.push("CtrlShiftHome"):l.push("ShiftHome"):(l.push("CtrlHome"),d=!0):l.push("Home"),h=g(l,t,f,r,i),l=[],h&&(p=!0),!p&&$.breakPoint&&0<$.breakPoint.horizontal&&0<o.x?$.index=y[A[o.y][0]].i:p||($.index=0)):(l.push("Close"),d=!0):(l.push("Open"),d=!0),p||d||$.index===c||$.setFocus.apply($.nodes[$.index],[t,$]),t.stopPropagation(),t.preventDefault()}else 9!==s||x.alt||x.ctrl?27!==s||x.alt||x.ctrl||x.shift?46===s?x.alt||x.ctrl||x.shift?x.alt||!x.ctrl||x.shift?x.alt||x.ctrl||!x.shift?!x.alt&&x.ctrl&&x.shift&&l.push("CtrlShiftDelete"):l.push("ShiftDelete"):l.push("CtrlDelete"):l.push("Delete"):33===s||34===s?x.alt||x.ctrl||x.shift?!x.alt||x.ctrl||x.shift?x.alt||!x.ctrl||x.shift?x.alt||x.ctrl||!x.shift?!x.alt&&x.ctrl&&x.shift&&l.push(33===s?"CtrlShiftPageUp":"CtrlShiftPageDown"):l.push(33===s?"ShiftPageUp":"ShiftPageDown"):l.push(33===s?"CtrlPageUp":"CtrlPageDown"):l.push(33===s?"AltPageUp":"AltPageDown"):l.push(33===s?"PageUp":"PageDown"):13===s||32===s?13===s?(x.alt||x.ctrl||x.shift?x.alt||!x.ctrl||x.shift?x.alt||x.ctrl||!x.shift?!x.alt&&x.ctrl&&x.shift&&l.push("CtrlShiftEnter"):l.push("ShiftEnter"):l.push("CtrlEnter"):l.push("Enter"),l.push("Open")):32===s&&(x.alt||x.ctrl||x.shift?x.alt||!x.ctrl||x.shift?x.alt||x.ctrl||!x.shift?!x.alt&&x.ctrl&&x.shift&&l.push("CtrlShiftSpace"):l.push("ShiftSpace"):l.push("CtrlSpace"):l.push("Space")):!(48<=s&&s<=57||65<=s&&s<=90)||x.alt||x.ctrl||x.shift||($.keyReset&&clearTimeout($.keyReset),$.keyReset=setTimeout(function(){$.typed=""},1e3),function(){$.lastTyped===s?$.typed=String.fromCharCode(s):$.typed+=String.fromCharCode(s);for(var t,e,n=$.isTree?$.top.treeNodes:$.nodes,i=0,o=$.isTree?$A.data(f,"RTI-TreeIndex"):$.index,a=o+1,r=n.length-1,l=!1;a<=r;a++)if(t=n[a],e=$A.data(t,"AccName")||"",!$A.isHidden(t)&&0===e.indexOf($.typed.toLowerCase())){l=!0,$.focus(t);break}if(!l)for(;i<o;i++)if(t=n[i],e=$A.data(t,"AccName")||"",!$A.isHidden(t)&&0===e.indexOf($.typed.toLowerCase())){$.focus(t);break}}(),$.lastTyped=s,t.stopPropagation(),t.preventDefault()):(l.push("Esc"),l.push("Close")):x.shift?l.push("ShiftTab"):l.push("Tab");g(l,t,f,r,i)},keyup:function(t,e){u(t);var n=[],i=$.children.get(f),o=i&&i.DC||e,a=$A.keyEvent(t),r=37<=a&&a<=40?a:0;if($.DC&&($.DC.loading||$.DC.closing)||o&&(o.loading||o.closing))return t.preventDefault(),t.stopPropagation(),!1;"a"!==t.key||x.alt||!x.ctrl||x.shift?"c"!==t.key||x.alt||!x.ctrl||x.shift?"x"!==t.key||x.alt||!x.ctrl||x.shift?"v"!==t.key||x.alt||!x.ctrl||x.shift||n.push("Paste"):n.push("Cut"):n.push("Copy"):n.push("SelectAll"),g(n,t,f,o,r)},focus:function(t,e){var n=$.children.get(f),i=n&&n.DC||e;$.index=o,$.setFocus.apply($.nodes[$.index],[t,$]),g(["Focus"],t,f,i,0)}},".RovingTabIndex"),$A.setAttr(f,{tabindex:o===$.index?0:-1})},"array")},$.isTree){$.top.treeNodes=[];var a=function(t,o){t.length&&$A.loop(t,function(t,e){var n=o.children.get(e),i=o.top.treeNodes.length;$A.data(e,"RTI-TreeIndex",i),o.top.treeNodes[i]=e,n&&$A.isArray(n.nodes)&&a(n.nodes,n)},"array")};a($.top.nodes,$.top)}return $.on(),$}})}});