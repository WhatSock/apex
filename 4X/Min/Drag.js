/*@license
Drag Module 1.0 for Apex 4X
Author: Bryan Garaventa (https://www.linkedin.com/in/bgaraventa)
Home: WhatSock.com  :  Download: https://github.com/whatsock/apex
License: MIT (https://opensource.org/licenses/MIT)
*/
"setDrag"in $A||$A.import(["Animate","Menu","Dragula.css","Dragula"],{name:"DragModule",once:!0,props:props,call:function(n){$A.extend({setDrag:function(l){var m=(l=$A.extend(!0,{render:"append",sort:!1,dragula:{revertOnSpill:!0,invalid:function(n,t){return!1},accepts:function(n,t,a,e){return!!p||a!==t}},menu:{manualDrop:function(n,t,a,e,o,r){return!1},tag:{render:"append",button:'<a aria-label="Actions" class="aria-action-menu-button">&darr;</a>',menu:'<ul hidden class="drag top menu"></ul>',move:'<li><a data-action="move" class="menu-action move">Move to %DROPNAME%</a></li>',copy:'<li><a data-action="copy" class="menu-action copy">Copy to %DROPNAME%</a></li>',up:'<li><a data-action="up" class="menu-action up">Move Up</a></li>',left:'<li><a data-action="up" class="menu-action left">Move Left</a></li>',down:'<li><a data-action="down" class="menu-action down">Move Down</a></li>',right:'<li><a data-action="down" class="menu-action right">Move Right</a></li>',custom:[],customActivate:null,invalid:function(n,t,a,e){return!1}}}},l)).dragula.copy||!1,p=l.sort||l.dragula.copySortSource||!1,i=function(o,c,a){if($A.isArray(o))$A.loop(o,function(n,t){i(t,c,a)},"array");else{var d=$A.data(o,"actions");if(d&&($A.remove(d.button),$A.remove(d.menu),$A.destroy(d.DC)),$A.isArray(a)&&a.length){if(d={button:$A.morph(l.menu.tag.button),menu:$A.morph(l.menu.tag.menu),children:[],dragElement:o,sourceContainer:c},p){var n=$A.getOrientation(c.children),t="horizontal"===n.orientation&&!n.lineWrap;if($A.previous(o)){var e=$A.morph(l.menu.tag[t?"left":"up"]);d.children.push(e),d.menu.appendChild(e)}if($A.next(o)){var r=$A.morph(l.menu.tag[t?"right":"down"]);d.children.push(r),d.menu.appendChild(r)}}$A.loop(a,function(n,t){var a=($A.getAttr(t,"data-dropname")||"").replace(/<|>/g,"");if(!a)throw"The drop-zone container element is missing a unique and informative data-dropname attribute.";var e=$A.morph(l.menu.tag[m?"copy":"move"].replace("%DROPNAME%",a));l.dragula.accepts(o,t,c)&&t!==c&&($A.data(e,"DropContainer",t),d.children.push(e),d.menu.appendChild(e))},"array"),$A.loop(l.menu.tag.custom,function(n,t){var a=$A.morph(t);l.menu.tag.invalid(o,$A.getAttr(a.firstChild,"data-action"),c)||(d.children.push(a),d.menu.appendChild(a))},"array"),$A[l.menu.tag.render](d.button,o),$A.after(d.menu,d.button),$A(d.button).describedBy(o),$A.setKBA11Y(d.button,"button"),$A(d.button).on("click mousedown mouseup mousemove touchstart touchend touchmove",function(n){n.stopPropagation()}),d.DC=$A.setMenu(d.button,$A.extend(!0,{toggleHide:!0,onActivate:function(o,r,n,t,a,e,i){var u=$A.data(r.parentNode,"DropContainer");n.DC.top.remove(function(){var n=$A.previous(d.dragElement),t=$A.next(d.dragElement),a=t||c,e=$A.getAttr(r,"data-action");s.emit("beforeClone",d.dragElement),!p||"up"!==e&&"down"!==e?u?s.emit("drop",d.dragElement,u,c,t,function(){l.menu.manualDrop(d.dragElement,u,c,e,d,a)||$A[l.render](m?d.dragElement.cloneNode(!0):d.dragElement,u),s.emit("dragend",d.dragElement),$A.data(t,"actions")&&(a=$A.data(t,"actions").button),$A.focus(a)}):$A.isFn(l.menu.tag.customActivate)&&(l.menu.manualDrop(d.dragElement,u,c,e,d,t)||l.menu.tag.customActivate(o,d.dragElement,c,e,d,a),s.emit("dragend",d.dragElement),$A.data(t,"actions")&&(a=$A.data(t,"actions").button),$A.focus(a)):s.emit("drop",d.dragElement,u,c,t,function(){l.menu.manualDrop(d.dragElement,u,c,e,d,a)||("up"===e?($A.before(d.dragElement,n),s.emit("dragend",d.dragElement),$A.data(d.dragElement,"actions")&&(a=$A.data(d.dragElement,"actions").button),$A.focus(a)):"down"===e&&($A.after(d.dragElement,t),s.emit("dragend",d.dragElement),$A.data(d.dragElement,"actions")&&(a=$A.data(d.dragElement,"actions").button),$A.focus(a)))})})},animate:{onRender:function(n,t,a){Velocity(t,"transition.slideUpIn",{complete:function(){a()}})},onRemove:function(n,t,a){Velocity(t,"transition.slideUpOut",{complete:function(){a()}})}},click:function(n,t){n.stopPropagation()},mouseDown:function(n,t){n.stopPropagation()},mouseUp:function(n,t){n.stopPropagation()},mouseMove:function(n,t){n.stopPropagation()},touchStart:function(n,t){n.stopPropagation()},touchEnd:function(n,t){n.stopPropagation()},touchMove:function(n,t){n.stopPropagation()}},l.menu)),$A.data(o,"actions",d)}}},s=dragula(l.dragula).on("beforeClone",function(n){i(n)}).on("drop",function(n,t,a,e,o){$A.isFn(o)&&o()}).on("dragend",function(n){t()}),t=function(){$A.loop(s.containers,function(n,t){i(t.children,t,s.containers)},"array")};return t(),s},unsetDrag:function(n){$A.loop(n.containers,function(n,t){$A.loop(t.children,function(n,t){var a=$A.data(t,"actions");a&&($A.remove(a.button),$A.remove(a.menu),$A.destroy(a.DC))},"array")},"array"),n.destroy()}})}});